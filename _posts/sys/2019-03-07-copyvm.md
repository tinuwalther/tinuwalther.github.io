---
layout: post
title:  "Copy items using psremote-session"
author: Tinu
tags:   SystemEngineering
permalink: /posts/:title:output_ext
---

# Table of Contents

- [Table of Contents](#table-of-contents)
- [Copy-ToVirtualMachine](#copy-tovirtualmachine)
- [Copy-FromVirtualMachine](#copy-fromvirtualmachine)
- [See also](#see-also)

Copy items from a local to a remote computer using a psremote-session.

# Copy-ToVirtualMachine

````powershell
function Copy-ToVirtualMachine{

    <#

    .SYNOPSIS
       Copy to VM

    .DESCRIPTION
       Copy content over an PSSession to a VM

    .PARAMETER ComputerName
       VM name to copy to

    .PARAMETER creds
       Credentials of the VM to copy to

    .PARAMETER Source
       Source folder
 
    .PARAMETER Destination
       Destination folder on the VM
 
    .EXAMPLE
    Copy-ToVirtualMachine -ComputerName 'Server01' - creds $creds -Source 'C:\Export\*' -Destination 'C:\Import'

    #>

    [CmdletBinding()]
    param(
        [Parameter(Mandatory=$true)]
        [String] $ComputerName,

        [Parameter(Mandatory=$true)]
        [PSCredential] $creds,

        [Parameter(Mandatory=$false)]
        [String] $Source = 'D:\Export\*',

        [Parameter(Mandatory=$false)]
        [String] $Destination = 'C:\Import'
    )

    $function = $($MyInvocation.MyCommand.Name)
    Write-Host "$(Get-Date -f 'yyyy-MM-dd HH:mm:ss.ffff') Starting $function" -ForegroundColor Yellow
    $rsession = New-PSSession -ComputerName $ComputerName -Credential $creds
    Copy-Item -ToSession $rsession -Path $Source -Destination $Destination -Force -Recurse
    Remove-PSSession -Session $rsession
    Write-Host "$(Get-Date -f 'yyyy-MM-dd HH:mm:ss.ffff') End $function" -ForegroundColor Yellow
}
````

# Copy-FromVirtualMachine

````powershell
function Copy-FromVirtualMachine{

    <#

    .SYNOPSIS
       Copy from a VM

    .DESCRIPTION
       Copy content over an PSSession from a VM

    .PARAMETER ComputerName
       VM name to copy to

    .PARAMETER creds
       Credentials of the VM to copy to

    .PARAMETER Source
       Source folder
 
    .PARAMETER Destination
       Destination folder on the VM
 
    .EXAMPLE
    Copy-FromVirtualMachine -ComputerName 'Server01' - creds $creds -Source 'C:\Export\*' -Destination 'C:\Import'

    #>

    [CmdletBinding()]
    param(
        [Parameter(Mandatory=$true)]
        [String] $ComputerName,

        [Parameter(Mandatory=$true)]
        [PSCredential] $creds,

        [Parameter(Mandatory=$false)]
        [String] $Source = 'C:\Export\*',

        [Parameter(Mandatory=$false)]
        [String] $Destination = 'D:\Import'
    )

    $function = $($MyInvocation.MyCommand.Name)
    Write-Host "$(Get-Date -f 'yyyy-MM-dd HH:mm:ss.ffff') Starting $function" -ForegroundColor Yellow
    $rsession = New-PSSession -ComputerName $ComputerName -Credential $creds
    Copy-Item -FromSession $rsession -Path $Source -Destination $Destination -Force -Recurse
    Remove-PSSession -Session $rsession
    Write-Host "$(Get-Date -f 'yyyy-MM-dd HH:mm:ss.ffff') End $function" -ForegroundColor Yellow
}
````

````powershell
$ComputerName  = 'W2K16RC-SRV03'
$creds   = Get-Credential -Message "Enter the credentials to connect to $ComputerName" -UserName 'Administrator'
Copy-ToVirtualMachine -ComputerName 'Server01' - creds $creds -Source 'C:\Export\*' -Destination 'C:\Import'
````

# See also

[New-PSSession](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/new-pssession?view=powershell-6) and
[Copy-Item](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/copy-item?view=powershell-6) on Microsoft Docs.

[ [Top](#table-of-contents) ] [ [Blog](../syseng.html) ]