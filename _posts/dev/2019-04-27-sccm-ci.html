<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>Table of Contents</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
    </head>
    <body>
        <hr>
<h2 id="layout-posttitle-%22sccm-configurationitem%22author-tinucategories-%22configuration-management%22tags-powershellpermalink-poststitleoutputext">layout: post
title:  &quot;SCCM ConfigurationItem&quot;
author: Tinu
categories: &quot;Configuration-Management&quot;
tags:   PowerShell
permalink: /posts/:title:output_ext</h2>
<p>Automate the System Center Configuration Manager with PowerShell.</p>
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#connect-to-the-sccm-server">Connect to the SCCM Server</a></li>
<li><a href="#configuration-baseline">Configuration Baseline</a>
<ul>
<li><a href="#create-a-configuration-baseline">Create a Configuration Baseline</a></li>
<li><a href="#create-configuration-item">Create Configuration Item</a></li>
<li><a href="#add-registrykeyvalue-settings-to-configuration-item">Add RegistryKeyValue Settings to Configuration Item</a></li>
<li><a href="#add-powershell-script-settings-to-configuration-item">Add PowerShell Script Settings to Configuration Item</a></li>
<li><a href="#add-existencerule-to-configuration-item">Add ExistenceRule to Configuration Item</a></li>
<li><a href="#add-valuerule-to-configuration-item">Add ValueRule to Configuration Item</a></li>
<li><a href="#add-configuration-item-to-baseline">Add Configuration Item to Baseline</a></li>
</ul>
</li>
<li><a href="#see-also">See also</a></li>
</ul>
<h1 id="connect-to-the-sccm-server">Connect to the SCCM Server</h1>
<p>Importing the Configuration Manager PowerShell Module and connect to the CMServer and CMSite:</p>
<pre><code class="language-powershell"><div>cd <span class="hljs-string">'C:\Program Files (x86)\Microsoft Configuration Manager\AdminConsole\bin'</span>
<span class="hljs-built_in">Import-Module</span> \ConfigurationManager.psd1

<span class="hljs-built_in">New-PSDrive</span> -Name <span class="hljs-variable">$SiteCode</span> -PSProvider <span class="hljs-string">"AdminUI.PS.Provider\CMSite"</span> -Root <span class="hljs-variable">$SiteServer</span> -Description <span class="hljs-variable">$SiteCode</span>
</div></code></pre>
<h1 id="configuration-baseline">Configuration Baseline</h1>
<p>To create a Configuration Baseline, you need a Baseline, and one or more ConfigurationItems with settings to test and rules.</p>
<ol>
<li>Create a Configuration Baseline</li>
<li>Create a Configuration Item</li>
<li>Add Configuration Setting without a Rule</li>
<li>Add Configuration Rule to the Setting</li>
<li>Add Configuration Item to the Baseline</li>
</ol>
<h2 id="create-a-configuration-baseline">Create a Configuration Baseline</h2>
<p>Create a new Baseline (remove it before adding new Configuration Items):</p>
<pre><code class="language-powershell"><div><span class="hljs-variable">$baseline</span> = @{
    Name         = <span class="hljs-string">'CB_Test-Base'</span>
    Description  = <span class="hljs-string">'This is a Test-Baseline'</span>
}
<span class="hljs-variable">$cb</span> = Get-CMBaseline -Name <span class="hljs-variable">$baseline</span>.Name
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$cb</span>){
    Remove-CMBaseline -Name <span class="hljs-variable">$baseline</span>.Name -Force
}
<span class="hljs-variable">$cb</span> = New-CMBaseline @baseline
</div></code></pre>
<h2 id="create-configuration-item">Create Configuration Item</h2>
<p>Create a new empty Configuration Item:</p>
<pre><code class="language-powershell"><div><span class="hljs-variable">$ci</span> = Get-CMConfigurationItem -Name <span class="hljs-string">'Test-OS-ReleaseId'</span> -Fast
<span class="hljs-keyword">if</span>(<span class="hljs-nomarkup">-not</span>(<span class="hljs-variable">$ci</span>)){
    <span class="hljs-variable">$properties</span> = @{
        Name         = <span class="hljs-string">'Test-OS-ReleaseId'</span>
        Description  = <span class="hljs-string">'The OS ReleaseId should be 1703'</span>
        CreationType = <span class="hljs-string">'WindowsOS'</span>
    }
    <span class="hljs-variable">$ci</span> = New-CMConfigurationItem @properties
}
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$ci</span>){
    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"SCCM ConfigurationItem $(<span class="hljs-variable">$ci</span>.LocalizedDisplayName) successfully created"</span> -ForegroundColor Green
}
</div></code></pre>
<h2 id="add-registrykeyvalue-settings-to-configuration-item">Add RegistryKeyValue Settings to Configuration Item</h2>
<p>Add a new CMComplianceSettingRegistryKeyValue to an existent Configuration Item.</p>
<p>DataType:</p>
<ul>
<li>String, Integer</li>
</ul>
<p>Hive:</p>
<ul>
<li>ClassesRoot, CurrentConfig, CurrentUser, LocalMachine, Users</li>
</ul>
<pre><code class="language-powershell"><div><span class="hljs-variable">$settings</span> = @{
    <span class="hljs-comment">#Settings to test</span>
    SettingName           = <span class="hljs-string">'ReleaseId must exist'</span>
    DataType              = <span class="hljs-string">'String'</span>
    Hive                  = <span class="hljs-string">'LocalMachine'</span>
    KeyName               = <span class="hljs-string">'SOFTWARE\Microsoft\Windows NT\CurrentVersion'</span>
    ValueName             = <span class="hljs-string">'ReleaseId'</span>
    NoRule                = <span class="hljs-literal">$true</span>
}
<span class="hljs-variable">$ci</span> = <span class="hljs-variable">$ConfigurationItem</span> | Add-CMComplianceSettingRegistryKeyValue @settings
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$ci</span>){
    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"SCCM ConfigurationItem $(<span class="hljs-variable">$ci</span>.LocalizedDisplayName) successfully created"</span> -ForegroundColor Green
    <span class="hljs-variable">$setting</span> = <span class="hljs-variable">$ConfigurationItem</span> | Get-CMComplianceSetting -SettingName <span class="hljs-string">'ReleaseId must exist'</span>
    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"SCCM ConfigurationItem $(<span class="hljs-variable">$setting</span>.Name) successfully created"</span> -ForegroundColor Green
}
</div></code></pre>
<h2 id="add-powershell-script-settings-to-configuration-item">Add PowerShell Script Settings to Configuration Item</h2>
<p>Add a new CMComplianceSettingScript to an existent Configuration Item:</p>
<p>DataType:</p>
<ul>
<li>String, DateTime, Integer, FloatingPoint, Version, Boolean</li>
</ul>
<p>DiscoveryLanguage:</p>
<ul>
<li>PowerShell, VBScript, JScript, ShellScript</li>
</ul>
<pre><code class="language-powershell"><div><span class="hljs-variable">$ScriptText</span> = <span class="hljs-string">@"
`$(Get-ItemPropertyValue -Path HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion -Name ReleaseId)
"@</span>

<span class="hljs-variable">$settings</span> = @{
    <span class="hljs-comment">#Settings to test</span>
    SettingName             = <span class="hljs-string">'ReleaseId must exist'</span>
    DataType                = <span class="hljs-string">'String'</span>
    DiscoveryScriptLanguage = <span class="hljs-string">'PowerShell'</span>
    DiscoveryScriptText     = <span class="hljs-variable">$ScriptText</span>
    <span class="hljs-comment">#DiscoveryScriptFile    = 'C:\Scripts\Get-ReleaseId.ps1'</span>
    NoRule                  = <span class="hljs-literal">$true</span>
}
<span class="hljs-variable">$ci</span> = <span class="hljs-variable">$ConfigurationItem</span> | Add-CMComplianceSettingRegistryKeyValue @settings
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$ci</span>){
    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"SCCM ConfigurationItem $(<span class="hljs-variable">$ci</span>.LocalizedDisplayName) successfully created"</span> -ForegroundColor Green
    <span class="hljs-variable">$setting</span> = <span class="hljs-variable">$ConfigurationItem</span> | Get-CMComplianceSetting -SettingName <span class="hljs-string">'ReleaseId must exist'</span>
    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"SCCM ConfigurationItem $(<span class="hljs-variable">$setting</span>.Name) successfully created"</span> -ForegroundColor Green
}
</div></code></pre>
<h2 id="add-existencerule-to-configuration-item">Add ExistenceRule to Configuration Item</h2>
<p>Existence:</p>
<ul>
<li>IsEquals, NotEquals, BeginsWith, NotBeginsWith, EndsWith, NotEndsWith, Contains, NotContains, OneOf, NoneOf</li>
</ul>
<pre><code class="language-powershell"><div><span class="hljs-variable">$ExistentialRule</span> = @{
    <span class="hljs-comment">#Compliance Rule</span>
    RuleName              = <span class="hljs-string">'Should be MustNotExist'</span>
    Existence             = <span class="hljs-string">'MustNotExist'</span>
    NoncomplianceSeverity = <span class="hljs-string">'Warning'</span>
}
<span class="hljs-variable">$rule</span> = <span class="hljs-variable">$setting</span> | New-CMComplianceRuleExistential @ExistentialRule
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"SCCM ConfigurationItem $(<span class="hljs-variable">$rule</span>.Name) successfully created"</span> -ForegroundColor Green
<span class="hljs-variable">$temp</span> = <span class="hljs-variable">$ConfigurationItem</span> | Add-CMComplianceSettingRule -Rule <span class="hljs-variable">$rule</span>
</div></code></pre>
<h2 id="add-valuerule-to-configuration-item">Add ValueRule to Configuration Item</h2>
<p>ExpressionOperator:</p>
<ul>
<li>And, Or, Other, IsEquals, NotEquals, GreaterThan, LessThan, Between, NotBetween, GreaterEquals, LessEquals, BeginsWith, NotBeginsWith, EndsWith, NotEndsWith, Contains, NotContains, AllOf, OneOf, NoneOf, SetEquals, SubsetOf, ExcludesAll</li>
</ul>
<pre><code class="language-powershell"><div><span class="hljs-variable">$ValueRule</span> = @{
    <span class="hljs-comment">#Compliance Rule</span>
    ValueRule             = <span class="hljs-literal">$true</span>
    RuleName              = <span class="hljs-string">'The ReleaseId must be 1703'</span>
    ExpressionOperator    = <span class="hljs-string">'IsEqual'</span>
    ExpectedValue         = <span class="hljs-string">'1703'</span>
    ReportNoncompliance   = <span class="hljs-literal">$true</span>
    NoncomplianceSeverity = <span class="hljs-string">'Warning'</span>
}
<span class="hljs-variable">$rule</span> = <span class="hljs-variable">$setting</span> | New-CMComplianceRuleExistential @ValueRule
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"SCCM ConfigurationItem $(<span class="hljs-variable">$rule</span>.Name) successfully created"</span> -ForegroundColor Green
<span class="hljs-variable">$temp</span> = <span class="hljs-variable">$ConfigurationItem</span> | Add-CMComplianceSettingRule -Rule <span class="hljs-variable">$rule</span>
</div></code></pre>
<h2 id="add-configuration-item-to-baseline">Add Configuration Item to Baseline</h2>
<p>Add each ConfigurationItem to a Baseline.</p>
<pre><code class="language-powershell"><div><span class="hljs-keyword">if</span>(<span class="hljs-variable">$cb</span>){
    Set-CMBaseline -Name <span class="hljs-variable">$baseline</span>.Name -AddOSConfigurationItem <span class="hljs-variable">$ci</span>.CI_ID
}
</div></code></pre>
<h1 id="see-also">See also</h1>
<p><a href="https://docs.microsoft.com/en-us/powershell/module/configurationmanager/?view=sccm-ps">ConfigurationManager</a> on Microsoft Docs</p>
<p><a href="https://blog.ctglobalservices.com/uncategorized/rja/create-configurationitems-and-baselines-without-killing-your-mouse/">Create ConfigurationItems and Baselines without killing your mouse</a> on CTGlobal</p>
<p>[ <a href="#table-of-contents">Top</a> ] [ <a href="../categories.html">Blog</a> ]</p>

    </body>
    </html>