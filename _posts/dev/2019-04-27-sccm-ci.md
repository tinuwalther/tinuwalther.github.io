---
layout: post
title:  "SCCM Automation"
author: Tinu
tags:   PowerShell
permalink: /posts/:title:output_ext
---

Automate the System Center Configuration Manager with PowerShell.

# Table of Contents

- [Table of Contents](#table-of-contents)
- [Connect to the SCCM Server](#connect-to-the-sccm-server)
- [New-CMConfigurationItem](#new-cmconfigurationitem)
- [Add-CMComplianceSettingRegistryKeyValue](#add-cmcompliancesettingregistrykeyvalue)
- [Create ConfigurationItem and Rule for RegistryKeyValue](#create-configurationitem-and-rule-for-registrykeyvalue)
  - [Commandlets](#commandlets)
  - [ConfigurationItem Settings](#configurationitem-settings)
  - [ConfigurationItem Rule](#configurationitem-rule)
  - [PowerShell code](#powershell-code)
- [See also](#see-also)

# Connect to the SCCM Server

Importing the Configuration Manager PowerShell Module and connect to the CMServer and CMSite:

````powershell
cd 'C:\Program Files (x86)\Microsoft Configuration Manager\Admin\Console\bin'
Import-Module .ConfigurationManager.psd1

New-PSDrive -Name [yoursitecode] -PSProvider "AdminUI.PS.Provider\CMSite" -Root "[your SCCM server's FQDN]" -Description "SCCM Site"
````

# New-CMConfigurationItem

Create a new empty Configuration Item:

````powershell
$ci = Get-CMConfigurationItem -Name 'Test-OS-ReleaseId' -Fast
if(-not($ci)){
    $properties = @{
        Name         = 'Test-OS-ReleaseId'
        Description  = 'The OS ReleaseId should be 1703'
        CreationType = 'WindowsOS'
    }
    $ci = New-CMConfigurationItem @properties
}
````

# Add-CMComplianceSettingRegistryKeyValue

Add a new CMComplianceSettingRegistryKeyValue to an existent Configuration Item:

````powershell
$ci = Get-CMConfigurationItem -Name 'Test-OS-ReleaseId' -Fast
if($ci){
    $properties = @{

        #Settings to test
        SettingName           = 'ReleaseId must exist'
        DataType              = 'String'
        Hive                  = 'LocalMachine'
        KeyName               = 'SOFTWARE\Microsoft\Windows NT\CurrentVersion'
        ValueName             = 'ReleaseId'

        #Compliance Rule
        ValueRule             = $true
        RuleName              = 'The ReleaseId must be 1703'
        ExpressionOperator    = 'IsEqual'
        ExpectedValue         = '1703'
        ReportNoncompliance   = $true
        NoncomplianceSeverity = 'Warning'

    }
    $ci | Add-CMComplianceSettingRegistryKeyValue @properties
}
````

# Create ConfigurationItem and Rule for RegistryKeyValue

Create a new Configuration Item with a Compliance Rule for RegistryKeyValue.

## Commandlets

Get-CMConfigurationItem, New-CMConfigurationItem, Add-CMComplianceSettingRegistryKeyValue

## ConfigurationItem Settings

DataType:

- String, or Integer

Hive:

- ClassesRoot, CurrentConfig, CurrentUser, LocalMachine, or Users

## ConfigurationItem Rule

ExpressionOperator:  
can be IsEquals, NotEquals, BeginsWith, NotBeginsWith, EndsWith, NotEndsWith, Contains, NotContains, OneOf, NoneOf  

NoncomplianceSeverity:  
can be None, Informational, Warning, Critical, CriticalWithEvent

## PowerShell code

````powershell
$CI_Name = 'Automated_CI-RegistryValue'
$ci = Get-CMConfigurationItem -Name $CI_Name -Fast

if(-not($ci)){
    Write-Host "ConfigurationItem $CI_Name will be created" -ForegroundColor Green
    $properties = @{
        Name         = $CI_Name
        Description  = 'The OS ReleaseId should be 1703'
        CreationType = 'WindowsOS'

    }
    $ci = New-CMConfigurationItem @properties

    $properties = @{

        #Settings to test
        SettingName           = 'ReleaseId must exist'
        DataType              = 'String'
        Hive                  = 'LocalMachine'
        KeyName               = 'SOFTWARE\Microsoft\Windows NT\CurrentVersion'
        ValueName             = 'ReleaseId'

        #Compliance Rule
        ValueRule             = $true
        RuleName              = 'The ReleaseId must be 1703'
        ExpressionOperator    = 'IsEqual'
        ExpectedValue         = '1703'
        ReportNoncompliance   = $true
        NoncomplianceSeverity = 'Warning'

    }
    $null = $ci | Add-CMComplianceSettingRegistryKeyValue @properties
}
````

# See also

[ConfigurationManager](https://docs.microsoft.com/en-us/powershell/module/configurationmanager/?view=sccm-ps) on Microsoft Docs

[System Center Configuration Manager Cmdlet Library](https://docs.microsoft.com/en-US/powershell/sccm/1706_release_notes?view=sccm-ps) on Microsoft Docs

[ [Top](#table-of-contents) ] [ [Blog](../devops.html) ]