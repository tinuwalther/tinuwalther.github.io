---
layout: post
title:  "Windows Updates"
author: Tinu
categories: "System-Engineering"
tags:   PowerShell
permalink: /posts/:title:output_ext
---

# Table of Contents

- [Table of Contents](#table-of-contents)
- [Possible causes of Windows update problems](#possible-causes-of-windows-update-problems)
- [Find Information about Hotfixes](#find-information-about-hotfixes)
- [See also](#see-also)

# Possible causes of Windows update problems

1. Diskspace less than 20GB -> ````$FreeDiskGB = (Get-CimInstance -ClassName Win32_logicaldisk | Where-Object {$_.DeviceID -eq 'C:'}).FreeSpace/1gb````
2. Memory less than 800MB -> ````$FreeMemMB = (Get-CimInstance -Class Win32_OperatingSystem).FreePhysicalMemory / 1024````
3. Pending Reboots -> https://www.powershellgallery.com/packages/PendingReboot
4. Corrupt Software Distribution Folder ````"$($env:SystemRoot)\SoftwareDistribution"````
5. Corrput Window Update Signatures ````"$($env:windir)\System32\catroot", "$($env:windir)\System32\catroot2"````
6. Services wuauserv, cryptsvc, BITS, msiserver
7. Errors in Device Manager -> https://tinuwalther.github.io/posts/devicemgr.html
8. Proxy Settings

# Find Information about Hotfixes

Get-HotFix cmdlet wraps the Win32_QuickFixEngineering WMI class, investigate in Win32_ReliabilityRecords.

````powershell
Get-Hotfix | Sort-Object InstalledOn -Descending

Source        Description      HotFixID      InstalledBy          InstalledOn
------        -----------      --------      -----------          -----------
Computer      Security Update  KB4503308     NT AUTHORITY\SYSTEM  27.06.2019 00:00:00
````

````powershell
Get-CimInstance -Class Win32_QuickFixEngineering | Sort-Object InstalledOn -Descending

Source        Description      HotFixID      InstalledBy          InstalledOn
------        -----------      --------      -----------          -----------
              Security Update  KB4503308     NT AUTHORITY\SYSTEM  27.06.2019 00:00:00
````

````powershell
$InstalledUpdate = Get-WmiObject -Class Win32_ReliabilityRecords -filter "SourceName = 'Microsoft-Windows-WindowsUpdateClient'" |
Select-Object @{LABEL = "InstalledOn";EXPRESSION = {$_.ConvertToDateTime($_.timegenerated)}}, User, Productname

$InstalledUpdate | ForEach-Object {

    $expression = $_.Productname
    $regex1  = '^\d{4}\-\d{2}'
    $regex2  = 'KB\d{6,7}'

    $patchID = $expression | select-string -Pattern $regex1 -AllMatches | ForEach-Object {$_.Matches.Value}
    $patchKB = $expression | select-string -Pattern $regex2 -AllMatches | ForEach-Object {$_.Matches.Value}

    [PSCustomObject]@{

        InstalledOn = $_.InstalledOn
        InstalledBy = $_.User
        HotFixID    = $patchKB
        UpdateID    = $patchID
        Description = $_.Productname

    } | ft
}

InstalledOn         InstalledBy         HotFixID UpdateID Description
-----------         -----------         -------- -------- -----------
27.06.2019 08:16:55 NT AUTHORITY\SYSTEM KB4503308 2019-06  Security Update for Adobe Flash Player for Windows 10...
````

# See also

[Find Information About Hotfixes](https://devblogs.microsoft.com/scripting/use-powershell-to-easily-find-information-about-hotfixes/)

[ [Top](#table-of-contents) ] [ [Blog](../categories.html) ]